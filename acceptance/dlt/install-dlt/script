title "install dlt"
dlt=$(trace errcode $CLI install-dlt -o json | jq -r .symlink_path)
trace $dlt | head -n1 | grep -q "DLT CLI" && echo "DLT command verified" || echo "DLT command failed"

title "dlt already installed"
trace errcode $CLI install-dlt
rm -f "$(dirname $CLI)/dlt"

title "dlt file exists, should not overwrite"
mkdir -p tmpdir
touch tmpdir/dlt
trace errcode $CLI install-dlt -d tmpdir -o json | jq -r .symlink_path
rm -rf tmpdir

title "Executable not called as databricks"
cp $CLI notdatabricks
dlt=$(trace errcode ./notdatabricks install-dlt -o json | jq -r .symlink_path)
trace $dlt | head -n1 | grep -q "DLT CLI" && echo "DLT command verified" || echo "DLT command failed"
rm -f notdatabricks
rm -f dlt
